<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csii.webhook.dao.TestDao">
 <resultMap id="TaskQueryMap" type="com.alibaba.da.coin.ide.spi.standard.TaskQuery">
     <result property="sessionId" column="sessionId"/><!--会话ID，session内的对话此ID相同-->
     <result property="utterance" column="utterance"/><!--用户输入语句-->
     <result property="skillId" column="skillId"/><!--技能ID-->
     <result property="skillName" column="skillName"/><!--技能名称-->
     <result property="token" column="token"/><!--技能鉴权token，可以不需要，如果有安全需求需要配置-->
     <result property="intentId" column="intentId"/><!--意图ID-->
     <result property="intentName" column="intentName"/><!--意图名称-->
     <result property="botId" column="botId"/><!--应用ID，来自于创建的应用或者技能-->
     <result property="domainId" column="domainId"/><!--领域ID-->
 </resultMap>
    <!--private Map<String, String> requestData = null;--><!--业务请求附带参数,来自于设备调用语义理解服务额外携带的信息，只做透传-->
    <!--private List<SlotEntity> slotEntities = null;--><!--从用户语句中抽取出的slot参数信息-->
    <!--private List<ConversationRecord> conversationRecords = null;-->
    <!-- private Map<String, SessionEntry> sessionEntries;-->
    <insert id="saveTaskQuery"  parameterType="com.csii.webhook.model.pojo.TaskQuery" useGeneratedKeys="true" keyProperty="taskQueryId">

        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="taskQueryId" keyColumn="taskQueryId">
            SELECT LAST_INSERT_ID() AS taskQueryId
        </selectKey>
        insert into taskquery
        (sessionId,utterance,skillId,skillName,token,intentId,intentName,botId,domainId)
        values
         (#{sessionId},#{utterance},#{skillId},#{skillName},#{token},#{intentId},#{intentName},#{botId},#{domainId})
    </insert>
    <!--保存taskquery 集合requestData数据-->
    <insert id="saveTaskQueryReqMapData" useGeneratedKeys="true" keyProperty="reuqestid" parameterType="com.csii.webhook.model.pojo.TaskQueryReqData">
         insert into requestdata
         (mapkey,mapvalue,taskqueryid)
         values
        (#{key},#{value},#{taskQueryId})

    </insert>

    <!--插入taskQuery Slot集合-->
    <insert id="saveTaskQuerySlotEntity" useGeneratedKeys="true" keyProperty="slotId" keyColumn="soltentityid" parameterType="com.csii.webhook.model.pojo.SlotEntity">
        insert into
        slot
        (intentParameterId,intentParameterName,originalValue,standardValue,liveTime,createTimeStamp,slotName,slotValue,taskqueryid)
         values
         <foreach collection="list" item="item" index="index" separator=",">
        (#{item.intentParameterId},#{item.intentParameterName},#{item.originalValue},#{item.standardValue},#{item.liveTime},#{item.createTimeStamp},#{item.slotName},#{item.slotValue},#{item.taskqueryid})
         </foreach>
    </insert>

    <!--存储taskQuery 的List<ConversationRecord>-->
    <insert id="saveTaskQueryConRcdEntity" useGeneratedKeys="true" keyProperty="conversationRecordId" keyColumn="conversationRecordId" parameterType="com.csii.webhook.model.pojo.ConversationRecord">
        insert into
        conversationrecord
        (botId,userInputUtterance,replyUtterance,domainId,intentId,intentName,timestamp,resultType,taskqueryid)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.botId},#{item.userInputUtterance},#{item.replyUtterance},#{item.domainId},#{item.intentId},#{item.intentName},#{item.timestamp},#{item.resultType},#{item.taskQueryId})
        </foreach>
    </insert>

    <!--存储sessionentry-->
    <insert id="saveTaskQuerySessionEntry" useGeneratedKeys="true" keyProperty="sessionentryid" keyColumn="sessionentryid" parameterType="com.csii.webhook.model.pojo.SessionEntry">
         insert into sessionentry
         (timeToLive,liveTime,timeStamp,value,sessionkey,taskQueryId)
         values
        (#{timeToLive},#{liveTime},#{timeStamp},#{value},#{sessionkey},#{taskQueryId})

    </insert>

</mapper>